<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}">
    <link rel="stylesheet" type="text/css"  th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css"  th:href="@{/css/footer.css}">
    <link rel="stylesheet" type="text/css"  th:href="@{/css/home_landing.css}">

    <title>Document</title>
    <style type="text/css">
        .glyphicon { margin-right:5px; }
        .thumbnail
        {
            margin-bottom: 20px;
            padding: 0px;
            -webkit-border-radius: 0px;
            -moz-border-radius: 0px;
            border-radius: 0px;
        }

        .item.list-group-item
        {
            float: none;
            width: 100%;
            background-color: #fff;
            margin-bottom: 10px;
        }
        .item.list-group-item:nth-of-type(odd):hover,.item.list-group-item:hover
        {
            background: #428bca;
        }

        .item.list-group-item .list-group-image
        {
            margin-right: 10px;
        }
        .item.list-group-item .thumbnail
        {
            margin-bottom: 0px;
        }
        .item.list-group-item .caption
        {
            padding: 9px 9px 0px 9px;
        }
        .item.list-group-item:nth-of-type(odd)
        {
            background: #eeeeee;
        }

        .item.list-group-item:before, .item.list-group-item:after
        {
            display: table;
            content: " ";
        }

        .item.list-group-item img
        {
            float: left;
        }
        .item.list-group-item:after
        {
            clear: both;
        }
        .list-group-item-text
        {
            margin: 0 0 11px;
        }

    </style>
    <style>
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: 1px solid #888;
            width: 80%;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
            from {top:-300px; opacity:0}
            to {top:0; opacity:1}
        }

        @keyframes animatetop {
            from {top:-300px; opacity:0}
            to {top:0; opacity:1}
        }

        /* The Close Button */
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-header {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }

        .modal-body {padding: 2px 16px;}

        .modal-footer {
            padding: 2px 16px;
            background-color: #5cb85c;
            color: white;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
</head>
<body ng-app="myApp" ng-controller="homeCtrl">

<div class="wrapper">
    <!--<div id="header"></div>-->
    <div th:replace="fragments/header :: header_info"></div>
    <div class="panner-top embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/Xws9AGH4ayc?rel=0&autoplay=1&mute=1&loop=1;&controls=0&showinfo=0&start=5&showinfo=0&enablejsapi=1&origin=https:%2F%2Fcanifa.com?controls=0"
                width="auto" height="720" frameborder="0"></iframe>
    </div>

    <div class="sale-information__inner">
        <img class="" th:src="@{/img/TMDT-04.jpg}" alt="">
    </div>

    <div class="banner-bottom">
        <div class="row banner-bottom__inner">
            <div class="col-lg-6 banner-item">
                <div class="banner-item_inner ">
                    <img src="https://canifa.s3.amazonaws.com/media/wysiwyg/banner2018/aoni_nu.jpg" alt="">
                </div>
            </div>
            <div class="col-lg-6 banner-item">
                <div class="banner-item_inner ">
                    <img src="https://canifa.s3.amazonaws.com/media/wysiwyg/banner2018/aoni_nam.jpg" alt="">
                </div>
            </div>
        </div>
    </div>

    <h2>Sản Phẩm Rẻ Nhất</h2>
    <div class="container" >
        <div id="products" class="row list-group">
            <div class="item  col-xs-3 col-lg-3" ng-repeat="product in productCheap">
                <div class="thumbnail">
                    <a href="" ng-click="detailProduct(product.id)"><img class="group list-group-image" src="http://localhost:8080{{product.image}}" alt="" style="height: 170px;width: 250px;" /></a>
                    <div class="caption">
                        <h4 class="group inner list-group-item-heading">
                            {{product.name}}</h4>
                        <p class="group inner list-group-item-text">
                            {{product.description}}</p>
                        <div class="row">
                            <div class="col-xs-12 col-md-6">
                                <p class="lead">
                                    ${{product.price}}</p>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <a class="btn btn-success" ng-click="addItemToCart(product.id)">Add to cart</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="celebaration-title clear-fix">
        <div class="titlle-video_advert">
            <h3>BST CELEBRATION ON EARTH</h3>
        </div>
        <a href="">Nam</a>
        <a href="">Nữ</a>
    </div>

    <div class="panner-top embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/TOSH7k5mAZE?rel=0&mute=1&loop=1;&controls=0&showinfo=0&start=5&showinfo=0&enablejsapi=1&origin=https:%2F%2Fcanifa.com?controls=0"
                width="auto" height="720" frameborder="0"></iframe>
    </div>

    <div class="celebaration-title clear-fix">
        <div class="titlle-video_advert">
            <h3>BST Be Active Be Cool</h3>
            <h5>Năng động để tỏa sáng</h5>
        </div>
        <a href="">Nam</a>
        <a href="">Nữ</a>
    </div>

    <div class="panner-top embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/BsaefDlmRN8?rel=0&mute=1&loop=1;&controls=0&showinfo=0&start=5&showinfo=0&enablejsapi=1&origin=https:%2F%2Fcanifa.com?controls=0"
                width="auto" height="720" frameborder="0"></iframe>
    </div>

    <div class="sale-box">
        <div class="row">
            <div class="col-lg-7">
                <div class="sale-left_background">
                    <div class="sale-left_inner">
                        <h4>TRANG TIN</h4>
                        <h1>KHUYẾN MÃI</h1>
                        <a href=""><span>CHI TIẾT</span></a>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="sale-right pull-right">
                    <img class="img-responsive" src="https://canifa.com/skin/frontend/canifa/default/images/home-upgrade-demo/sale-up-to.jpg" alt="">
                    <ul class="link-list">
                        <li><a href="#">NAM</a></li>
                        <li><a href="#">NỮ</a></li>
                        <li><a href="#">BÉ TRAI</a></li>
                        <li><a href="#">BÉ GÁI</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="advert_more">
        <div class="row">
            <div class="col-lg-4">
                <div class="advert-item__inner">
                    <a href="">
                        <h3>CUNG CẤP ĐỒNG PHỤC</h3>
                    </a>
                    <p>CANIFA nhận cung cấp hàng trăm mẫu áo đồng phục dành cho văn phòng, lớp học, nhóm bạn, câu lạc bộ. </p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="advert-item__inner">
                    <a href="">
                        <h3>CUNG CẤP ĐỒNG PHỤC</h3>
                    </a>
                    <p>CANIFA nhận cung cấp hàng trăm mẫu áo đồng phục dành cho văn phòng, lớp học, nhóm bạn, câu lạc bộ. </p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="advert-item__inner">
                    <a href="">
                        <h3>CUNG CẤP ĐỒNG PHỤC</h3>
                    </a>
                    <p>CANIFA nhận cung cấp hàng trăm mẫu áo đồng phục dành cho văn phòng, lớp học, nhóm bạn, câu lạc bộ. </p>
                </div>
            </div>
        </div>
    </div>

    <div class="register-follow">
        <div class="row">
            <div class="col-lg-5">
                <a class="" href="">
                    <div class="social-link icon-follow pull-right">
                        <!--<img th:src="@{/img/img-general.png}" alt="">-->
                    </div>
                </a>

                <a href="https://www.facebook.com/">
                    <div class="facebook-link icon-follow pull-right">
                        <!--<img th:src="@{/img/img-general.png}" alt="">-->
                    </div>
                </a>

                <h3 class="follow_us pull-right">Follow us</h3>
            </div>
            <div class="col-lg-7">
                <input id="inputEmailRegester" type="text" placeholder="Đăng kí nhận thông tin sự kiện khuyến mại">
                <button id="inputEmailRegester_button">Đăng KÝ</button>
            </div>
        </div>
    </div>

    ﻿<h2>﻿Blog - Chuyển động Canifa</h2>
    <div class="canifa-news">
        <div class="row">
            <div class="col-lg-6">
                <a href=""><img class="img-responsive" src="https://canifa.com/skin/frontend/canifa/default/images/home-upgrade-demo/sale-up-to.jpg" alt=""></a>
            </div>
            <div class="col-lg-6">
                <h2>Phối đồ với màu tím " thủy chung": Không khó nếu bạn đọc 6 cách dưới đây!</h2>
                <h5>18.01.2018</h5>
                <p>Mùa đông được coi là thời điểm mà các gam màu trầm tối thống trị trong hầu hết outfit từ nhà ra ngõ. Song đừng để xu hướng ấy giới hạn sắc màu phong cách cá biệt của bản thân bởi bạn hoàn toàn có thể thay đổi không khí ảm đạm ngày đông bằng cách chơi màu với trang phục. Mùa đông này, tại sao không thử nghiệm với sắc tím? Trong cẩm nang lần này, CANIFA sẽ giới thiệu đến bạn những bí quyết đặc biệt nhất khi lên đồ với gam màu khó nhằn này, để vừ...</p>
                <h3>Các tin khác</h3>

                <table id="other-news_table">
                    <tr>
                        <td>10.01.2018</td>
                        <td>10 cách kết hợp áo sơ mi và áo len nữ để bạn "nổi bần bật" trong mùa đông này</td>
                    </tr>
                    <tr>
                        <td>08.01.2018</td>
                        <td>Mặc đẹp không phải nghĩ " với 6 cách lên đồ với màu vàng sau đây</td>
                    </tr>
                    <tr>
                        <td>08.01.2018</td>
                        <td>Mặc đẹp không phải nghĩ " với 6 cách lên đồ với màu vàng sau đây</td>
                    </tr>
                    <tr>
                        <td>08.01.2018</td>
                        <td>Mặc đẹp không phải nghĩ " với 6 cách lên đồ với màu vàng sau đây</td>
                    </tr>
                    <tr>
                        <td>08.01.2018</td>
                        <td>Mặc đẹp không phải nghĩ " với 6 cách lên đồ với màu vàng sau đây</td>
                    </tr>


                </table>
            </div>
        </div>
    </div>

    <h2>HỆ THỐNG CỬA HÀNG</h2>
    <p>Thông tin về cửa hàng, cơ hội nghề nghiệp và dịch vụ khách hàng</p>
    <div id="canifa_policy">
        <div class="row">
            <div class="col-lg-4"></div>
        </div>
    </div>

    <ul class="canifa-policy_box row">
        <li class="policy-item_inner col-lg-4">
            <a href=""><img class="img-responsive" src="https://canifa.s3.amazonaws.com/media/wysiwyg/banners-2017/ReturnPolicy.png" alt=""></a>
            <h4>Quy định đổi sản phẩm</h4>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci architecto blanditiis consequatur corporis delectus dolores eos exercitationem</p>
        </li>

        <li class="policy-item_inner col-lg-4">
            <a href=""><img class="img-responsive" src="https://canifa.s3.amazonaws.com/media/wysiwyg/banners-2017/ReturnPolicy.png" alt=""></a>
            <h4>Quy định đổi sản phẩm</h4>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci architecto blanditiis consequatur corporis delectus dolores eos exercitationem</p>
        </li>

        <li class="policy-item_inner col-lg-4">
            <a href=""><img class="img-responsive" src="https://canifa.s3.amazonaws.com/media/wysiwyg/banners-2017/ReturnPolicy.png" alt=""></a>
            <h4>Quy định đổi sản phẩm</h4>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci architecto blanditiis consequatur corporis delectus dolores eos exercitationem</p>
        </li>
    </ul>

    <div th:replace="fragments/footer :: footer_info"></div>
</div>
    <script>
    // Get the modal
    var modal = document.getElementById('myModal');

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
    <script type="text/javascript">
        function getAllUrlParams(url) {

        // get query string from url (optional) or window
        var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

        // we'll store the parameters here
        var obj = {};

        // if query string exists
        if (queryString) {

            // stuff after # is not part of query string, so get rid of it
            queryString = queryString.split('#')[0];

            // split our query string into its component parts
            var arr = queryString.split('&');

            for (var i=0; i<arr.length; i++) {
                // separate the keys and the values
                var a = arr[i].split('=');

                // in case params look like: list[]=thing1&list[]=thing2
                var paramNum = undefined;
                var paramName = a[0].replace(/\[\d*\]/, function(v) {
                    paramNum = v.slice(1,-1);
                    return '';
                });

                // set parameter value (use 'true' if empty)
                var paramValue = typeof(a[1])==='undefined' ? true : a[1];

                // (optional) keep case consistent
                paramName = paramName.toLowerCase();
                paramValue = paramValue.toLowerCase();

                // if parameter name already exists
                if (obj[paramName]) {
                    // convert value to array (if still string)
                    if (typeof obj[paramName] === 'string') {
                        obj[paramName] = [obj[paramName]];
                    }
                    // if no array index number specified...
                    if (typeof paramNum === 'undefined') {
                        // put the value on the end of the array
                        obj[paramName].push(paramValue);
                    }
                    // if array index number specified...
                    else {
                        // put the value at that index number
                        obj[paramName][paramNum] = paramValue;
                    }
                }
                // if param name doesn't exist yet, set it
                else {
                    obj[paramName] = paramValue;
                }
            }
        }

        return obj;
    }

    </script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.5/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script th:src="@{/js/header.js}"></script>
    <script th:src="@{/js/home_landing.js}"></script>
	<script type="text/javascript">
        var app = angular.module('myApp', []);

        app.controller('homeCtrl', function($scope, $http, $interval) {


            $scope.cart=false;
            $scope.userId=getAllUrlParams().id;
            $scope.orderId=getAllUrlParams().o;
            $scope.isSearch=false;

            $scope.checkSale= true;
            var config={
                dataType: 'json',
                headers: {
                    "Content-Type": "application/json"
                }
            };
            var day= new Date();
            var timeNow={
                date:day.getFullYear()+'-'+(day.getMonth()+1)+'-'+day.getDate()
            };
            var dataPost = angular.toJson(timeNow, true);
            $http.post('http://localhost:8080/api/sale/detail',dataPost,config).then(function(response) {
                if (response.data.success == true) {
                    $scope.saleNow=response.data.data.saleNumber;
                    $scope.idsale=response.data.data.id;
                    $scope.checkSale=true;
                    $http.get('http://localhost:8080/api/sale/detailSale/'+$scope.idsale).then(function (response) {
                        $scope.date = new Date(response.data.data.endDate).getTime();
                        $interval(function () {
                            $scope.theTime = new Date().getTime();
                            var distance = $scope.date - $scope.theTime;

                            if(distance>0){
                                $scope.checkSale= true;
                                $scope.theDay =  Math.floor(distance / (1000 * 60 * 60 * 24));
                                $scope.theHour =  Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                $scope.theMinus = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                $scope.theSecond = Math.floor((distance % (1000 * 60)) / 1000);
                            }else{
                                $scope.checkSale=false;
                            }

                        }, 1000);

                    });
                }
            });

            $scope.checkSearch=function(){
                if($scope.searchProduct.length==0){
                    $scope.isSearch=false;
                }else{
                    $scope.isSearch=true;
                    console.log($scope.searchProduct);
                }
            };

            $http.get('http://localhost:8080/api/product/getAll').then(function (response) {
                $scope.listProductAll = response.data.data;
            });

            $http.get('http://localhost:8080/api/order/detailOrder/' + $scope.orderId ).then(function (response) {
                $scope.sale = response.data.data;
                console.log($scope.sale);
            });

            $http.get('http://localhost:8080/api/product/cheap').
            then(function(response) {
                $scope.productCheap = response.data.data;
            });

            if($scope.userId === undefined){

                $scope.userName="Login";
                $scope.countProduct=0;

                $scope.detailProductSearch=function(id){
                    $scope.searchProduct="";
                    window.location.href="/product_detail?id="+id;
                };
                $scope.detailProduct=function (productId) {
                    window.location.href="/product_detail?id="+productId;
                };
                $scope.detailCategory=function (id) {
                    window.location.href = "/category?c="+id;
                };
            }else {
                $http.get('http://localhost:8080/api/user/detail?id=' + $scope.userId).then(function (response) {
                    $scope.userName = response.data.data.name;
                    $scope.userEmail = response.data.data.email;
                    $scope.userAddress = response.data.data.address;
                    toastr.success('Đăng nhập thành công thành công !');
                        $http.get('http://localhost:8080/api/notification/getIsReadNoti/'+$scope.userId).then(function (response) {
                            $scope.numberNoti=response.data.data;

                        });
                });
                $scope.showNotifi=function () {
                    $http.get('http://localhost:8080/api/notification/getAllNoti/' + $scope.userId).then(function (response) {
                        $scope.listNotification=response.data.data;
                        console.log($scope.listNotification);

                        $http.get('http://localhost:8080/api/notification/updateNoti/' + $scope.userId).then(function (response) {
                            if(response.data.success){
                                $http.get('http://localhost:8080/api/notification/getIsReadNoti/'+$scope.userId).then(function (response) {
                                    $scope.numberNoti = response.data.data;
                                });
                            }
                        });
                    });
                };

                $scope.detailHistory=function () {
                    window.location.href = "/historyBuy?id="+$scope.userId +"&o="+$scope.orderId;
                };
                $scope.detailCategory=function (id) {
                    window.location.href = "/category?id="+$scope.userId +"&o="+$scope.orderId+"&c="+id;
                };
                $http.get('http://localhost:8080/api/order/countproduct?status=4&uid=' + $scope.userId).then(function (response) {
                    $scope.countProduct = response.data.data;
                });

                $http.get('http://localhost:8080/api/order/detail?statusId=4&userId=' + $scope.userId).then(function (response) {
                    $scope.productInCart = response.data.data;
                    var i = 0;
                        $scope.totalMoney = 0;
                        for (i = 0; i < $scope.productInCart.length; i++) {
                            $scope.totalMoney += $scope.productInCart[i].price * $scope.productInCart[i].quantity;
                        }
                        $scope.totalMoney = $scope.totalMoney - $scope.totalMoney * $scope.sale.saleNumber/100;


                });


                $scope.logout=function () {
                    $scope.userName="Login";
                    window.location.href = "/home";
                };

                $scope.addItemToCart = function (product) {
                    $http.get('http://localhost:8080/api/order/addProduct/' + $scope.orderId + "?productId=" + product + "&quantity=1").then(function (response) {
                        $http.get('http://localhost:8080/api/order/countproduct?status=4&uid=' + $scope.userId).then(function (response) {
                            $scope.countProduct = response.data.data;
                        });

                        var config={
                            dataType: 'json',
                            headers: {
                                "Content-Type": "application/json"
                            }
                        };
                        var day= new Date();
                        var timeNow={
                            date:day.getFullYear()+'-'+(day.getMonth()+1)+'-'+day.getDate()
                        };
                        var dataPost = angular.toJson(timeNow, true);
                        $http.post('http://localhost:8080/api/sale/detail',dataPost,config).then(function(response) {
                            if(response.data.success==true){

                                var saleDetail={
                                    saleId:response.data.data.id
                                };
                                dataPost=angular.toJson(saleDetail, true);
                                console.log($scope.sale.id+"id va id+"+saleDetail.saleId);
                                if( $scope.sale.id != saleDetail.saleId ) {
                                    $http.post('http://localhost:8080/api/order/update-order/' + $scope.orderId, dataPost, config).then(function (response) {
                                        $http.get('http://localhost:8080/api/order/detailOrder/' +$scope.orderId ).then(function (response) {
                                            $scope.sale = response.data.data;
                                            $http.get('http://localhost:8080/api/order/detail?statusId=4&userId=' + $scope.userId).then(function (response) {
                                                $scope.productInCart = response.data.data;
                                                var i = 0;
                                                $scope.totalMoney = 0;
                                                for (i = 0; i < $scope.productInCart.length; i++) {
                                                    $scope.totalMoney += $scope.productInCart[i].price * $scope.productInCart[i].quantity;
                                                }
                                                $scope.totalMoney = $scope.totalMoney - $scope.totalMoney * $scope.sale.saleNumber/100;


                                            });
                                        });
                                        toastr.success('Đã thêm  thành công !');
                                    });
                                }
                                else{
                                    $http.get('http://localhost:8080/api/order/detailOrder/' +$scope.orderId ).then(function (response) {
                                        $scope.sale = response.data.data;
                                        $http.get('http://localhost:8080/api/order/detail?statusId=4&userId=' + $scope.userId).then(function (response) {
                                            $scope.productInCart = response.data.data;
                                            var i = 0;
                                            $scope.totalMoney = 0;
                                            for (i = 0; i < $scope.productInCart.length; i++) {
                                                $scope.totalMoney += $scope.productInCart[i].price * $scope.productInCart[i].quantity;
                                            }
                                            $scope.totalMoney = $scope.totalMoney - $scope.totalMoney * $scope.sale.saleNumber/100;


                                        });
                                    });
                                    console.log('Thêm  thành cong hang khuyen mãi');
                                    toastr.success('Đã thêm  thành công !');
                                }
                            }else{

                                var saleDetail={
                                    saleId:4
                                };

                                dataPost = angular.toJson(saleDetail, true);
                                console.log(dataPost);
                                $http.post('http://localhost:8080/api/order/update-order/'+$scope.orderId,dataPost,config).then(function(response) {
                                    $http.get('http://localhost:8080/api/order/detailOrder/' +$scope.orderId ).then(function (response) {
                                        $scope.sale = response.data.data;
                                        $http.get('http://localhost:8080/api/order/detail?statusId=4&userId=' + $scope.userId).then(function (response) {
                                            $scope.productInCart = response.data.data;
                                            var i = 0;
                                            $scope.totalMoney = 0;
                                            for (i = 0; i < $scope.productInCart.length; i++) {
                                                $scope.totalMoney += $scope.productInCart[i].price * $scope.productInCart[i].quantity;
                                            }
                                            $scope.totalMoney = $scope.totalMoney - $scope.totalMoney * $scope.sale.saleNumber/100;


                                        });
                                    });
                                    console.log('mua hang thanh cong nhung giu nguyen giá');
                                    toastr.success('Đã thêm  thành công !');
                                });

                            }
                        });
                        $http.get('http://localhost:8080/api/order/detailOrder/' +$scope.orderId ).then(function (response) {
                            $scope.sale = response.data.data;
                        });
                    });

                };

                $scope.minusItemToCart = function (product) {
                    $http.get('http://localhost:8080/api/order/minusProduct/' + $scope.orderId + "?productId=" + product.productId + "&quantity=1").then(function (response) {
                        $http.get('http://localhost:8080/api/order/detail?statusId=4&userId=' + $scope.userId).then(function (response) {
                            $scope.productInCart = response.data.data;
                            var i = 0;
                            $scope.totalMoney = 0;
                            for (i = 0; i < $scope.productInCart.length; i++) {
                                $scope.totalMoney += $scope.productInCart[i].price * $scope.productInCart[i].quantity;
                            }
                            $scope.totalMoney = $scope.totalMoney - $scope.totalMoney * $scope.sale.saleNumber/100;
                            toastr.success('Đã giảm thành công !');
                        });
                    });
                };

                $scope.RemoveItem = function (product) {
                    $http.get('http://localhost:8080/api/order/deleteProduct?productId=' + product.productId + "&orderId=" + $scope.orderId).then(function (response) {
                        $http.get('http://localhost:8080/api/order/countproduct?status=4&uid=' + $scope.userId).then(function (response) {
                            $scope.countProduct = response.data.data;
                        });
                        $http.get('http://localhost:8080/api/order/detail?statusId=4&userId=' + $scope.userId).then(function (response) {
                            $scope.productInCart = response.data.data;
                            var i = 0;
                            $scope.totalMoney = 0;
                            for (i = 0; i < $scope.productInCart.length; i++) {
                                $scope.totalMoney += $scope.productInCart[i].price * $scope.productInCart[i].quantity;
                            }
                            $scope.totalMoney = $scope.totalMoney - $scope.totalMoney * $scope.sale.saleNumber/100;
                            toastr.success('Đã xóa thành công !');
                        });
                    });
                };

                $scope.detailProductSearch=function(id){
                    $scope.searchProduct="";
                    window.location.href="/product_detail?uid="+$scope.userId+"&o="+$scope.orderId+"&id="+id;
                };

                $scope.detailProduct=function (productId) {
                    window.location.href="/product_detail?uid="+$scope.userId+"&o="+$scope.orderId+"&id="+productId;
                };

                $scope.nextPage = function () {
                    window.location.href = "/createOrder?id=" + $scope.userId + "&o=" + $scope.orderId;
                };
            };

            app.config(function ($httpProvider) {
                $httpProvider.defaults.headers.common = {};
                $httpProvider.defaults.headers.post = {};
                $httpProvider.defaults.headers.put = {};
                $httpProvider.defaults.headers.patch = {};
            });

        });
	</script>
</div>
</body>
</html>